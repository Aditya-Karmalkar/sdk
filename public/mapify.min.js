var MapifyOS=function(){"use strict";class e{constructor(){this.baseUrl="https://us-central1-mapifyos.cloudfunctions.net"}async verifyApiKey(e){try{const t=await fetch(`${this.baseUrl}/verify?key=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)return!1;return!0===(await t.json()).valid}catch(e){return console.error("API key verification failed:",e),!1}}async searchPlaces(e,t){try{const{lat:n,lng:a,type:o="hospital",radius:i=3e3}=t,r=new URL(`${this.baseUrl}/search`);r.searchParams.append("lat",n),r.searchParams.append("lon",a),r.searchParams.append("type",o),r.searchParams.append("radius",i);const s=await fetch(r,{method:"GET",headers:{"X-API-Key":e,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Search API error: ${s.status}`);return(await s.json()).results||[]}catch(e){return console.error("Search API error:",e),[]}}async getPlaceDetails(e,t){try{const n=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&zoom=18&addressdetails=1`),a=await n.json(),o=`\n        [out:json][timeout:10];\n        (\n          way(around:30,${e},${t})[~"^(amenity|shop|office|building)$"~".*"];\n          node(around:30,${e},${t})[~"^(amenity|shop|office|building)$"~".*"];\n          relation(around:30,${e},${t})[~"^(amenity|shop|office|building)$"~".*"];\n        );\n        out tags center;\n      `,i=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`data=${encodeURIComponent(o)}`}),r=await i.json();return{nominatim:a,overpass:r.elements?.[0]||null}}catch(e){return console.error("Error fetching place details:",e),{nominatim:null,overpass:null}}}}class t{constructor(){this.defaultStyles="\n      .mapify-popup {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        padding: 16px;\n        min-width: 250px;\n        max-width: 320px;\n      }\n      .mapify-popup h3 {\n        margin: 0 0 8px 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: #1f2937;\n        line-height: 1.3;\n      }\n      .mapify-popup .category {\n        display: inline-block;\n        background: #dbeafe;\n        color: #1e40af;\n        font-size: 12px;\n        font-weight: 500;\n        padding: 4px 8px;\n        border-radius: 12px;\n        margin-bottom: 12px;\n      }\n      .mapify-popup .address {\n        color: #6b7280;\n        font-size: 14px;\n        line-height: 1.4;\n        margin-bottom: 12px;\n      }\n      .mapify-popup .contact-info {\n        margin-bottom: 12px;\n      }\n      .mapify-popup .contact-item {\n        display: flex;\n        align-items: center;\n        margin-bottom: 6px;\n        font-size: 14px;\n      }\n      .mapify-popup .contact-icon {\n        width: 16px;\n        height: 16px;\n        margin-right: 8px;\n        color: #6b7280;\n      }\n      .mapify-popup .contact-link {\n        color: #2563eb;\n        text-decoration: none;\n      }\n      .mapify-popup .contact-link:hover {\n        text-decoration: underline;\n      }\n      .mapify-popup .copy-button {\n        width: 100%;\n        background: #f3f4f6;\n        border: none;\n        color: #374151;\n        font-size: 14px;\n        font-weight: 500;\n        padding: 10px 12px;\n        border-radius: 6px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 0.2s;\n        margin-top: 12px;\n        border-top: 1px solid #e5e7eb;\n        padding-top: 12px;\n      }\n      .mapify-popup .copy-button:hover {\n        background: #e5e7eb;\n      }\n      .mapify-popup .copy-button.copied {\n        background: #dcfce7;\n        color: #166534;\n      }\n      .mapify-popup .copy-icon {\n        width: 16px;\n        height: 16px;\n        margin-right: 6px;\n      }\n      .mapify-loading {\n        display: flex;\n        align-items: center;\n        padding: 16px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n      .mapify-spinner {\n        width: 16px;\n        height: 16px;\n        border: 2px solid #e5e7eb;\n        border-top: 2px solid #2563eb;\n        border-radius: 50%;\n        animation: mapify-spin 1s linear infinite;\n        margin-right: 8px;\n      }\n      @keyframes mapify-spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n      .mapify-error {\n        padding: 16px;\n        color: #dc2626;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        text-align: center;\n      }\n    ",this.injectStyles()}injectStyles(){if(!document.getElementById("mapify-popup-styles")){const e=document.createElement("style");e.id="mapify-popup-styles",e.textContent=this.defaultStyles,document.head.appendChild(e)}}createPopupContent(e){const{name:t="Unknown Location",address:n="Address not available",type:a="Location",phone:o,website:i,hours:r}=e,s=n.replace(/'/g,"\\'");let p=`\n      <div class="mapify-popup">\n        <h3>${this.escapeHtml(t)}</h3>\n        ${"Location"!==a?`<div class="category">${this.escapeHtml(a)}</div>`:""}\n        <div class="address">${this.escapeHtml(n)}</div>\n        <div class="contact-info">\n    `;if(o&&"Not available"!==o&&(p+=`\n        <div class="contact-item">\n          <svg class="contact-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>\n          </svg>\n          <a href="tel:${o}" class="contact-link">${this.escapeHtml(o)}</a>\n        </div>\n      `),i){const e=i.replace(/^https?:\/\//,"").replace(/\/$/,"");p+=`\n        <div class="contact-item">\n          <svg class="contact-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9"></path>\n          </svg>\n          <a href="${i}" target="_blank" class="contact-link">${this.escapeHtml(e)}</a>\n        </div>\n      `}return r&&"Not available"!==r&&(p+=`\n        <div class="contact-item">\n          <svg class="contact-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n          </svg>\n          <span>${this.escapeHtml(r)}</span>\n        </div>\n      `),p+=`\n        </div>\n        <button class="copy-button" onclick="this.copyAddress('${s}', this)">\n          <svg class="copy-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>\n          </svg>\n          Copy Address\n        </button>\n      </div>\n    `,p}createSearchResultPopup(e){return this.createPopupContent({name:e.name,address:e.address||"Address not available",type:e.type?.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),phone:e.phone,website:e.website,hours:e.opening_hours})}createLoadingContent(){return'\n      <div class="mapify-loading">\n        <div class="mapify-spinner"></div>\n        <span>Loading place information...</span>\n      </div>\n    '}createErrorContent(){return'\n      <div class="mapify-error">\n        <p>Unable to load place information</p>\n      </div>\n    '}escapeHtml(e){if("string"!=typeof e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}}"undefined"!=typeof window&&(window.copyAddress=function(e,t){navigator.clipboard.writeText(e).then(()=>{const e=t.textContent;t.textContent="Copied!",t.classList.add("copied"),setTimeout(()=>{t.textContent=e,t.classList.remove("copied")},2e3)}).catch(e=>{console.error("Failed to copy address:",e)})});class n{constructor(n,a){this.containerId=n,this.options=a,this.map=null,this.currentLayer=null,this.markers=[],this.apiManager=new e,this.popupUI=new t,this.eventListeners=new Map,this.layers={plain:{name:"Plain",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"},terrain:{name:"Terrain",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",attribution:"© OpenTopoMap contributors"},satellite:{name:"Satellite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"© Esri"},dark:{name:"Dark",url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:"© CartoDB"}}}async initialize(){try{if("undefined"==typeof L)throw new Error("Leaflet library is required. Please include Leaflet before MapifyOS SDK.");this.map=L.map(this.containerId).setView(this.options.center,this.options.zoom),this.setLayer(this.options.layer),this.map.on("click",async e=>{await this.handleMapClick(e)}),this.options.enableLayerControl&&this.addLayerControl(),this.emit("ready",{map:this.map})}catch(e){throw console.error("Map initialization error:",e),e}}async handleMapClick(e){const{lat:t,lng:n}=e.latlng,a=L.popup().setLatLng([t,n]).setContent(this.popupUI.createLoadingContent()).openOn(this.map);try{const e=await this.apiManager.getPlaceDetails(t,n),o=this.formatPlaceData(e,t,n),i=this.popupUI.createPopupContent(o);a.setContent(i),this.emit("placeClick",{coordinates:{lat:t,lng:n},data:o})}catch(e){console.error("Error handling map click:",e),a.setContent(this.popupUI.createErrorContent())}}formatPlaceData(e,t,n){const{nominatim:a,overpass:o}=e,i=o?.tags||{};return{name:i.name||a?.name||a?.display_name?.split(",")[0]||"Unknown Location",address:a?.display_name||"Address not available",type:this.formatCategory(i),phone:i.phone||i["contact:phone"]||"Not available",website:i.website||i["contact:website"]||i.url||null,hours:i.opening_hours||"Not available",coordinates:{lat:t,lng:n}}}formatCategory(e){if(!e)return"Location";const t={amenity:e.amenity,shop:e.shop,building:e.building,leisure:e.leisure,tourism:e.tourism,highway:e.highway,office:e.office,craft:e.craft};for(const[e,n]of Object.entries(t))if(n)return n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return"Location"}async search(e,t={}){try{const n=t.center||this.map.getCenter(),a=t.radius||3e3,o=this.parseSearchQuery(e),i=await this.apiManager.searchPlaces(this.options.apiKey,{lat:n.lat,lng:n.lng,type:o,radius:a});if(this.clearSearchMarkers(),i.forEach(e=>{if(e.lat&&e.lng){const t=L.marker([e.lat,e.lng]).addTo(this.map).bindPopup(this.popupUI.createSearchResultPopup(e));this.markers.push(t)}}),i.length>0){const e=new L.featureGroup(this.markers);this.map.fitBounds(e.getBounds().pad(.1))}return this.emit("search",{query:e,results:i}),i}catch(t){return console.error("Search error:",t),this.emit("searchError",{query:e,error:t}),[]}}parseSearchQuery(e){const t=e.toLowerCase();return t.includes("hospital")?"hospital":t.includes("pharmacy")?"pharmacy":t.includes("clinic")?"clinic":t.includes("restaurant")?"restaurant":t.includes("gas")||t.includes("fuel")?"fuel":t.includes("bank")?"bank":t.includes("school")?"school":t.includes("hotel")?"hotel":t.includes("shop")||t.includes("store")?"shop":"amenity"}clearSearchMarkers(){this.markers.forEach(e=>{this.map.removeLayer(e)}),this.markers=[]}setLayer(e){this.layers[e]||(console.warn(`Layer '${e}' not found, using 'plain'`),e="plain"),this.currentLayer&&this.map.removeLayer(this.currentLayer);const t=this.layers[e];this.currentLayer=L.tileLayer(t.url,{attribution:t.attribution}).addTo(this.map),this.emit("layerChange",{layer:e})}addLayerControl(){const e={};Object.entries(this.layers).forEach(([t,n])=>{e[n.name]=L.tileLayer(n.url,{attribution:n.attribution})}),L.control.layers(e).addTo(this.map)}setView(e,t){this.map.setView(e,t),this.emit("viewChange",{center:e,zoom:t})}showPopup(e,t,n){L.popup().setLatLng([e,t]).setContent(n).openOn(this.map)}getLeafletMap(){return this.map}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){if(this.eventListeners.has(e)){const n=this.eventListeners.get(e),a=n.indexOf(t);a>-1&&n.splice(a,1)}}emit(e,t){this.eventListeners.has(e)&&this.eventListeners.get(e).forEach(n=>{try{n(t)}catch(t){console.error(`Error in event listener for '${e}':`,t)}})}destroy(){this.map&&(this.clearSearchMarkers(),this.map.remove(),this.map=null),this.eventListeners.clear()}}const a=new class{constructor(){this.apiManager=new e,this.popupUI=new t,this.instances=new Map}async init(e,t={}){try{if(!e)throw new Error("Container ID is required");if(!t.apiKey)throw new Error("API key is required");if(!document.getElementById(e))throw new Error(`Container with ID '${e}' not found`);if(!await this.apiManager.verifyApiKey(t.apiKey))throw new Error("Invalid or inactive API key");const a=new n(e,{center:t.center||[20.5937,78.9629],zoom:t.zoom||5,layer:t.layer||"plain",enableSearch:!1!==t.enableSearch,enableLayerControl:!1!==t.enableLayerControl,apiKey:t.apiKey});return await a.initialize(),this.instances.set(e,a),{map:a.getLeafletMap(),search:(t,n)=>this.search(e,t,n),setView:(e,t)=>a.setView(e,t),setLayer:e=>a.setLayer(e),destroy:()=>this.destroy(e),on:(e,t)=>a.on(e,t),off:(e,t)=>a.off(e,t)}}catch(e){throw console.error("MapifyOS initialization error:",e),e}}async search(e,t,n={}){const a=this.instances.get(e);if(!a)throw new Error(`Map instance '${e}' not found`);return await a.search(t,n)}async getPlaceDetails(e,t){try{const n=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&zoom=18&addressdetails=1`),a=await n.json(),o=`\n        [out:json][timeout:10];\n        (\n          way(around:30,${e},${t})[~"^(amenity|shop|office|building)$"~".*"];\n          node(around:30,${e},${t})[~"^(amenity|shop|office|building)$"~".*"];\n          relation(around:30,${e},${t})[~"^(amenity|shop|office|building)$"~".*"];\n        );\n        out tags center;\n      `,i=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`data=${encodeURIComponent(o)}`}),r=await i.json(),s=r.elements?.[0],p=s?.tags||{};return{name:p.name||a.name||a.display_name?.split(",")[0]||"Unnamed Location",address:a.display_name||"Address not available",type:p.amenity||p.shop||p.office||p.building||"Building",phone:p.phone||p["contact:phone"]||"Not available",website:p.website||p["contact:website"]||p.url||null,hours:p.opening_hours||"Not available",coordinates:{lat:e,lng:t}}}catch(n){return console.error("Error fetching place details:",n),{name:"Unknown Location",address:"Address not available",type:"Location",phone:"Not available",website:null,hours:"Not available",coordinates:{lat:e,lng:t}}}}showPopup(e,t,n,a){const o=this.instances.get(e);if(!o)throw new Error(`Map instance '${e}' not found`);const i=this.popupUI.createPopupContent(a);o.showPopup(t,n,i)}destroy(e){const t=this.instances.get(e);t&&(t.destroy(),this.instances.delete(e))}getVersion(){return"1.0.0"}getInstances(){return Array.from(this.instances.keys())}};return"undefined"!=typeof window&&(window.MapifyOS=a),"undefined"!=typeof module&&module.exports&&(module.exports=a),a}();
